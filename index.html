<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>City Weather • Open‑Meteo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f8f9fa; }
    .temp-display { font-size: 3rem; font-weight: 700; }
    .muted { color: #6c757d; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4 text-center">Check Current Weather</h1>

    <form id="weatherForm" class="row g-2 justify-content-center">
      <div class="col-12 col-md-6">
        <input id="cityInput" class="form-control form-control-lg" type="text" placeholder="Enter city name (e.g., London)" aria-label="City name" required />
      </div>
      <div class="col-12 col-md-auto d-grid">
        <button id="searchBtn" class="btn btn-primary btn-lg" type="submit">
          <span class="btn-text">Get Weather</span>
          <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
        </button>
      </div>
    </form>

    <div id="alertBox" class="alert mt-4 d-none" role="alert"></div>

    <div id="result" class="mt-4 d-none">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <strong id="cityTitle">City</strong>
            <span id="regionTitle" class="muted"></span>
          </div>
          <small class="text-muted" id="updatedTime"></small>
        </div>
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-6">
              <div class="temp-display">
                <span id="temperatureValue">--</span>
                <span class="badge bg-secondary ms-2" id="temperatureUnit">°C</span>
              </div>
              <div class="muted mt-2">Current temperature</div>
            </div>
            <div class="col-md-6">
              <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  Humidity
                  <span class="badge bg-info text-dark" id="humidityValue">-- %</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-footer text-muted small">
          Data by <a href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer">Open‑Meteo</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById('weatherForm');
    const cityInput = document.getElementById('cityInput');
    const searchBtn = document.getElementById('searchBtn');
    const spinner = searchBtn.querySelector('.spinner-border');
    const alertBox = document.getElementById('alertBox');
    const resultWrap = document.getElementById('result');

    const cityTitle = document.getElementById('cityTitle');
    const regionTitle = document.getElementById('regionTitle');
    const updatedTime = document.getElementById('updatedTime');
    const temperatureValue = document.getElementById('temperatureValue');
    const temperatureUnit = document.getElementById('temperatureUnit');
    const humidityValue = document.getElementById('humidityValue');

    function setLoading(isLoading) {
      searchBtn.disabled = isLoading;
      spinner.classList.toggle('d-none', !isLoading);
    }

    function showAlert(message, type = 'danger') {
      alertBox.className = `alert alert-${type} mt-4`;
      alertBox.textContent = message;
      alertBox.classList.remove('d-none');
    }

    function hideAlert() {
      alertBox.classList.add('d-none');
    }

    async function geocodeCity(name) {
      const url = new URL('https://geocoding-api.open-meteo.com/v1/search');
      url.searchParams.set('name', name);
      url.searchParams.set('count', '1');
      url.searchParams.set('language', 'en');
      url.searchParams.set('format', 'json');

      const res = await fetch(url);
      if (!res.ok) throw new Error('Geocoding request failed.');
      const data = await res.json();
      if (!data.results || !data.results.length) {
        throw new Error('City not found. Try a more specific name.');
      }
      return data.results[0]; // { latitude, longitude, name, country, admin1, ... }
    }

    async function fetchWeather(lat, lon) {
      const url = new URL('https://api.open-meteo.com/v1/forecast');
      url.searchParams.set('latitude', lat);
      url.searchParams.set('longitude', lon);
      url.searchParams.set('current', 'temperature_2m,relative_humidity_2m');
      url.searchParams.set('timezone', 'auto');

      const res = await fetch(url);
      if (!res.ok) throw new Error('Weather request failed.');
      return res.json();
    }

    function renderResult(place, weather) {
      const { name, country, admin1 } = place;
      const { current, current_units } = weather;

      cityTitle.textContent = name + (country ? `, ${country}` : '');
      regionTitle.textContent = admin1 ? ` • ${admin1}` : '';

      temperatureValue.textContent = current?.temperature_2m ?? '--';
      temperatureUnit.textContent = current_units?.temperature_2m ?? '°C';

      const rh = current?.relative_humidity_2m;
      const rhUnit = current_units?.relative_humidity_2m ?? '%';
      humidityValue.textContent = (rh ?? '--') + ' ' + rhUnit;

      // Show local time as provided by API
      updatedTime.textContent = current?.time ? `Updated: ${current.time} (${weather.timezone_abbreviation})` : '';

      resultWrap.classList.remove('d-none');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideAlert();
      resultWrap.classList.add('d-none');

      const query = cityInput.value.trim();
      if (!query) {
        showAlert('Please enter a city name.', 'warning');
        return;
      }

      setLoading(true);
      try {
        const place = await geocodeCity(query);
        const weather = await fetchWeather(place.latitude, place.longitude);
        renderResult(place, weather);
      } catch (err) {
        console.error(err);
        showAlert(err.message || 'Something went wrong. Please try again.');
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>